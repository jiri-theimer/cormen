@model UI.Models.TheComboViewModel


@{
    
    var _cols = new BL.TheGridColumns(new BO.myQuery(Model.Entity)).getDefaultPallete();
   
}

@(Html.Kendo().MultiColumnComboBox()
    .Name(Model.ControlID)
    .Placeholder(Model.PlaceHolder)
              .DataTextField(Model.getNameField())
              .DataValueField("pid")
    .Columns(columns =>
    {
        for (int i= 0; i <_cols.Count;i++) {
            columns.Add().Field(_cols[i].Field).Title(_cols[i].Header);
        }
    })


    .Events(e =>
    {
        if (String.IsNullOrEmpty(Model.CallerIDValue) == false)
        {
            e.Select("onSelect_" + Model.ControlID).Change("onChange_" + Model.ControlID);
        }
        if (String.IsNullOrEmpty(Model.Event_After_ChangeValue) == false)
        {
            e.Cascade(Model.Event_After_ChangeValue);
        }



    })

                    .HtmlAttributes(new { style="width:100%;" })
                    .Filter(FilterType.Contains)
    .Suggest(true)
                    .AutoBind(false)
                    .MinLength(1)
                    .HighlightFirst(true)



    .DataSource(source =>
    {
        source.Read(read =>
        {

            read.Action("GetJson4TheCombo", "TheGrid",new {entity=Model.Entity, addblankrow = false });
        })

        .ServerFiltering(true);
    })
    )




    <script type="text/javascript">
 $(document).ready(function () {
     var widget@(Model.ControlID) = $("#@Model.ControlID").getKendoMultiColumnComboBox();
     widget@(Model.ControlID).value("@Model.SelectedValue");
     widget@(Model.ControlID).text("@Model.SelectedText");

     widget@(Model.ControlID).input.on("click", function () {
         $(this).select();

            if (widget@(Model.ControlID).value() == null || widget@(Model.ControlID).value() == "" || widget@(Model.ControlID).value() == "0") {

                widget@(Model.ControlID).open();
            }
     });




 });




@if(Model.CallerIDValue != null)
{
    <text>
    function onSelect_@(@Model.ControlID)(e) {
        if (e.item) {
            _notify_message("onSelect_");

            var dataItem = this.dataItem(e.item.index());
            $("#@Model.CallerIDValue").val(dataItem.pid);
            $("#@Model.CallerIDText").val(dataItem.@Model.getNameField());

        }
    }

        function onChange_@(@Model.ControlID)(e) {

            _notify_message("onChange_: "+this.value());
        if (this.value() == this.text()) {
            this.value("");
            this.text("");
                $("#@Model.CallerIDValue").val("0");
                $("#@Model.CallerIDText").val("");
        }

        }
    </text>
}







    </script>
